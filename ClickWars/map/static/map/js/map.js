var francejson = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -4.7021484375,
              48.04870994288686
            ],
            [
              -4.41650390625,
              47.989921667414194
            ],
            [
              -4.41650390625,
              47.78363463526376
            ],
            [
              -3.9990234375,
              47.85740289465826
            ],
            [
              -3.3618164062499996,
              47.68018294648414
            ],
            [
              -3.05419921875,
              47.5913464767971
            ],
            [
              -2.7685546874999996,
              47.62097541515849
            ],
            [
              -2.6806640625,
              47.54687159892238
            ],
            [
              -2.79052734375,
              47.47266286861342
            ],
            [
              -2.57080078125,
              47.487513008956554
            ],
            [
              -2.43896484375,
              47.39834920035926
            ],
            [
              -2.48291015625,
              47.32393057095941
            ],
            [
              -2.2412109375,
              47.264320080254805
            ],
            [
              -2.1533203125,
              47.14489748555398
            ],
            [
              -1.99951171875,
              47.025206001585396
            ],
            [
              -2.08740234375,
              46.875213396722685
            ],
            [
              -1.6259765625,
              46.37725420510028
            ],
            [
              -1.23046875,
              46.34692761055676
            ],
            [
              -0.94482421875,
              46.36209301204985
            ],
            [
              -1.16455078125,
              46.210249600187225
            ],
            [
              -1.142578125,
              45.89000815866184
            ],
            [
              -1.34033203125,
              45.96642454131025
            ],
            [
              -1.2084960937499998,
              45.69083283645816
            ],
            [
              -0.85693359375,
              45.42929873257377
            ],
            [
              -0.63720703125,
              45.089035564831036
            ],
            [
              -1.0986328125,
              45.460130637921004
            ],
            [
              -1.2084960937499998,
              44.84029065139799
            ],
            [
              -1.03271484375,
              44.653024159812
            ],
            [
              -1.2084960937499998,
              44.59046718130883
            ],
            [
              -1.7578125,
              43.35713822211053
            ],
            [
              -1.3623046875,
              43.229195113965005
            ],
            [
              -1.34033203125,
              43.004647127794435
            ],
            [
              -0.7470703125,
              42.924251753870685
            ],
            [
              -0.54931640625,
              42.779275360241904
            ],
            [
              -0.263671875,
              42.79540065303723
            ],
            [
              -0.02197265625,
              42.71473218539458
            ],
            [
              0.17578125,
              42.71473218539458
            ],
            [
              0.50537109375,
              42.69858589169842
            ],
            [
              0.63720703125,
              42.87596410238256
            ],
            [
              1.1865234375,
              42.68243539838623
            ],
            [
              1.47216796875,
              42.66628070564928
            ],
            [
              1.669921875,
              42.61779143282346
            ],
            [
              1.5600585937499998,
              42.47209690919285
            ],
            [
              1.8237304687499998,
              42.53689200787315
            ],
            [
              2.021484375,
              42.391008609205045
            ],
            [
              2.548828125,
              42.35854391749705
            ],
            [
              3.05419921875,
              42.439674178149424
            ],
            [
              3.1640625,
              42.45588764197166
            ],
            [
              3.01025390625,
              43.18114705939968
            ],
            [
              3.8671874999999996,
              43.42100882994726
            ],
            [
              4.04296875,
              43.56447158721811
            ],
            [
              4.37255859375,
              43.43696596521823
            ],
            [
              4.68017578125,
              43.37311218382002
            ],
            [
              5.20751953125,
              43.29320031385282
            ],
            [
              5.82275390625,
              43.13306116240612
            ],
            [
              6.26220703125,
              43.08493742707592
            ],
            [
              6.6357421875,
              43.24520272203356
            ],
            [
              7.03125,
              43.48481212891603
            ],
            [
              7.580566406250001,
              43.77109381775651
            ],
            [
              7.646484374999999,
              44.213709909702054
            ],
            [
              6.943359374999999,
              44.465151013519616
            ],
            [
              7.00927734375,
              44.68427737181225
            ],
            [
              6.6796875,
              45.13555516012536
            ],
            [
              7.14111328125,
              45.321254361171476
            ],
            [
              6.767578125,
              45.82879925192134
            ],
            [
              7.00927734375,
              45.90529985724799
            ],
            [
              6.83349609375,
              46.210249600187225
            ],
            [
              6.767578125,
              46.483264729155586
            ],
            [
              6.1962890625,
              46.36209301204985
            ],
            [
              6.15234375,
              46.5286346952717
            ],
            [
              6.39404296875,
              46.73986059969267
            ],
            [
              6.459960937499999,
              46.9502622421856
            ],
            [
              6.8994140625,
              47.249406957888446
            ],
            [
              7.0751953125,
              47.368594345213374
            ],
            [
              6.943359374999999,
              47.3834738721015
            ],
            [
              6.96533203125,
              47.487513008956554
            ],
            [
              7.294921874999999,
              47.487513008956554
            ],
            [
              7.536621093749999,
              47.60616304386874
            ],
            [
              7.62451171875,
              48.122101028190805
            ],
            [
              7.71240234375,
              48.472921272487824
            ],
            [
              7.998046875,
              48.73445537176822
            ],
            [
              8.2177734375,
              48.980216985374994
            ],
            [
              7.646484374999999,
              49.06666839558117
            ],
            [
              7.294921874999999,
              49.15296965617042
            ],
            [
              6.8115234375,
              49.196064000723794
            ],
            [
              6.591796875,
              49.36806633482156
            ],
            [
              6.04248046875,
              49.453842594330716
            ],
            [
              5.537109374999999,
              49.52520834197442
            ],
            [
              4.85595703125,
              49.85215166776998
            ],
            [
              4.833984374999999,
              50.12057809796008
            ],
            [
              4.5703125,
              49.96535590991311
            ],
            [
              4.130859375,
              49.97948776108648
            ],
            [
              4.1748046875,
              50.14874640066278
            ],
            [
              4.06494140625,
              50.331436330838834
            ],
            [
              3.779296875,
              50.331436330838834
            ],
            [
              3.6474609374999996,
              50.401515322782366
            ],
            [
              3.33984375,
              50.52739681329302
            ],
            [
              3.1640625,
              50.80593472676908
            ],
            [
              2.8564453125,
              50.708634400828224
            ],
            [
              2.5927734375,
              50.90303283111257
            ],
            [
              2.5927734375,
              51.04139389812637
            ],
            [
              2.373046875,
              51.05520733858494
            ],
            [
              1.58203125,
              50.875311142200765
            ],
            [
              1.4501953125,
              50.05008477838256
            ],
            [
              0.24169921874999997,
              49.738681639280024
            ],
            [
              0.15380859375,
              49.52520834197442
            ],
            [
              0.263671875,
              49.410973199695846
            ],
            [
              -0.15380859375,
              49.31079887964633
            ],
            [
              -0.46142578125,
              49.33944093715546
            ],
            [
              -0.94482421875,
              49.396675075193976
            ],
            [
              -1.142578125,
              49.396675075193976
            ],
            [
              -1.3623046875,
              49.53946900793534
            ],
            [
              -1.2084960937499998,
              49.63917719651036
            ],
            [
              -1.494140625,
              49.681846899401286
            ],
            [
              -2.0654296875,
              49.69606181911566
            ],
            [
              -1.8896484375,
              49.52520834197442
            ],
            [
              -1.7578125,
              49.296471602658066
            ],
            [
              -1.64794921875,
              48.980216985374994
            ],
            [
              -1.47216796875,
              48.67645370777654
            ],
            [
              -1.77978515625,
              48.61838518688487
            ],
            [
              -1.8017578124999998,
              48.69096039092549
            ],
            [
              -2.109375,
              48.63290858589535
            ],
            [
              -2.373046875,
              48.647427805533546
            ],
            [
              -2.6806640625,
              48.516604348867475
            ],
            [
              -2.98828125,
              48.821332549646634
            ],
            [
              -3.251953125,
              48.79239019646406
            ],
            [
              -3.5815429687499996,
              48.76343113791796
            ],
            [
              -3.8232421874999996,
              48.66194284607006
            ],
            [
              -4.06494140625,
              48.67645370777654
            ],
            [
              -4.6142578125,
              48.60385760823255
            ],
            [
              -4.74609375,
              48.4146186174932
            ],
            [
              -4.2626953125,
              48.32703913063476
            ],
            [
              -4.5263671875,
              48.23930899024907
            ],
            [
              -4.2626953125,
              48.10743118848039
            ],
            [
              -4.7021484375,
              48.04870994288686
            ]
          ]
        ]
      }
    }
  ]
};

var test = {
  "type": "Polygon",
  "coordinates": [
    [
      [
        -77.15269088745116,
        38.87153962460514
      ],
      [
        -77.1521383523941,
        38.871322446566325
      ],
      [
        -77.15196132659912,
        38.87159391901113
      ],
      [
        -77.15202569961546,
        38.87162315444336
      ],
      [
        -77.1519023180008,
        38.87179021382536
      ],
      [
        -77.15266406536102,
        38.8727758561868
      ],
      [
        -77.1527713537216,
        38.87274662122871
      ],
      [
        -77.15282499790192,
        38.87282179681094
      ],
      [
        -77.15323269367218,
        38.87267562199469
      ],
      [
        -77.15313613414764,
        38.87254197618533
      ],
      [
        -77.15270698070526,
        38.87236656567917
      ],
      [
        -77.1523904800415,
        38.87198233162923
      ],
      [
        -77.15269088745116,
        38.87153962460514
      ]
    ]
  ]
};

var geom = {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -4.7021484375,
              48.04870994288686
            ],
            [
              -4.41650390625,
              47.989921667414194
            ],
            [
              -4.41650390625,
              47.78363463526376
            ],
            [
              -3.9990234375,
              47.85740289465826
            ],
            [
              -3.3618164062499996,
              47.68018294648414
            ],
            [
              -3.05419921875,
              47.5913464767971
            ],
            [
              -2.7685546874999996,
              47.62097541515849
            ],
            [
              -2.6806640625,
              47.54687159892238
            ],
            [
              -2.79052734375,
              47.47266286861342
            ],
            [
              -2.57080078125,
              47.487513008956554
            ],
            [
              -2.43896484375,
              47.39834920035926
            ],
            [
              -2.48291015625,
              47.32393057095941
            ],
            [
              -2.2412109375,
              47.264320080254805
            ],
            [
              -2.1533203125,
              47.14489748555398
            ],
            [
              -1.99951171875,
              47.025206001585396
            ],
            [
              -2.08740234375,
              46.875213396722685
            ],
            [
              -1.6259765625,
              46.37725420510028
            ],
            [
              -1.23046875,
              46.34692761055676
            ],
            [
              -0.94482421875,
              46.36209301204985
            ],
            [
              -1.16455078125,
              46.210249600187225
            ],
            [
              -1.142578125,
              45.89000815866184
            ],
            [
              -1.34033203125,
              45.96642454131025
            ],
            [
              -1.2084960937499998,
              45.69083283645816
            ],
            [
              -0.85693359375,
              45.42929873257377
            ],
            [
              -0.63720703125,
              45.089035564831036
            ],
            [
              -1.0986328125,
              45.460130637921004
            ],
            [
              -1.2084960937499998,
              44.84029065139799
            ],
            [
              -1.03271484375,
              44.653024159812
            ],
            [
              -1.2084960937499998,
              44.59046718130883
            ],
            [
              -1.7578125,
              43.35713822211053
            ],
            [
              -1.3623046875,
              43.229195113965005
            ],
            [
              -1.34033203125,
              43.004647127794435
            ],
            [
              -0.7470703125,
              42.924251753870685
            ],
            [
              -0.54931640625,
              42.779275360241904
            ],
            [
              -0.263671875,
              42.79540065303723
            ],
            [
              -0.02197265625,
              42.71473218539458
            ],
            [
              0.17578125,
              42.71473218539458
            ],
            [
              0.50537109375,
              42.69858589169842
            ],
            [
              0.63720703125,
              42.87596410238256
            ],
            [
              1.1865234375,
              42.68243539838623
            ],
            [
              1.47216796875,
              42.66628070564928
            ],
            [
              1.669921875,
              42.61779143282346
            ],
            [
              1.5600585937499998,
              42.47209690919285
            ],
            [
              1.8237304687499998,
              42.53689200787315
            ],
            [
              2.021484375,
              42.391008609205045
            ],
            [
              2.548828125,
              42.35854391749705
            ],
            [
              3.05419921875,
              42.439674178149424
            ],
            [
              3.1640625,
              42.45588764197166
            ],
            [
              3.01025390625,
              43.18114705939968
            ],
            [
              3.8671874999999996,
              43.42100882994726
            ],
            [
              4.04296875,
              43.56447158721811
            ],
            [
              4.37255859375,
              43.43696596521823
            ],
            [
              4.68017578125,
              43.37311218382002
            ],
            [
              5.20751953125,
              43.29320031385282
            ],
            [
              5.82275390625,
              43.13306116240612
            ],
            [
              6.26220703125,
              43.08493742707592
            ],
            [
              6.6357421875,
              43.24520272203356
            ],
            [
              7.03125,
              43.48481212891603
            ],
            [
              7.580566406250001,
              43.77109381775651
            ],
            [
              7.646484374999999,
              44.213709909702054
            ],
            [
              6.943359374999999,
              44.465151013519616
            ],
            [
              7.00927734375,
              44.68427737181225
            ],
            [
              6.6796875,
              45.13555516012536
            ],
            [
              7.14111328125,
              45.321254361171476
            ],
            [
              6.767578125,
              45.82879925192134
            ],
            [
              7.00927734375,
              45.90529985724799
            ],
            [
              6.83349609375,
              46.210249600187225
            ],
            [
              6.767578125,
              46.483264729155586
            ],
            [
              6.1962890625,
              46.36209301204985
            ],
            [
              6.15234375,
              46.5286346952717
            ],
            [
              6.39404296875,
              46.73986059969267
            ],
            [
              6.459960937499999,
              46.9502622421856
            ],
            [
              6.8994140625,
              47.249406957888446
            ],
            [
              7.0751953125,
              47.368594345213374
            ],
            [
              6.943359374999999,
              47.3834738721015
            ],
            [
              6.96533203125,
              47.487513008956554
            ],
            [
              7.294921874999999,
              47.487513008956554
            ],
            [
              7.536621093749999,
              47.60616304386874
            ],
            [
              7.62451171875,
              48.122101028190805
            ],
            [
              7.71240234375,
              48.472921272487824
            ],
            [
              7.998046875,
              48.73445537176822
            ],
            [
              8.2177734375,
              48.980216985374994
            ],
            [
              7.646484374999999,
              49.06666839558117
            ],
            [
              7.294921874999999,
              49.15296965617042
            ],
            [
              6.8115234375,
              49.196064000723794
            ],
            [
              6.591796875,
              49.36806633482156
            ],
            [
              6.04248046875,
              49.453842594330716
            ],
            [
              5.537109374999999,
              49.52520834197442
            ],
            [
              4.85595703125,
              49.85215166776998
            ],
            [
              4.833984374999999,
              50.12057809796008
            ],
            [
              4.5703125,
              49.96535590991311
            ],
            [
              4.130859375,
              49.97948776108648
            ],
            [
              4.1748046875,
              50.14874640066278
            ],
            [
              4.06494140625,
              50.331436330838834
            ],
            [
              3.779296875,
              50.331436330838834
            ],
            [
              3.6474609374999996,
              50.401515322782366
            ],
            [
              3.33984375,
              50.52739681329302
            ],
            [
              3.1640625,
              50.80593472676908
            ],
            [
              2.8564453125,
              50.708634400828224
            ],
            [
              2.5927734375,
              50.90303283111257
            ],
            [
              2.5927734375,
              51.04139389812637
            ],
            [
              2.373046875,
              51.05520733858494
            ],
            [
              1.58203125,
              50.875311142200765
            ],
            [
              1.4501953125,
              50.05008477838256
            ],
            [
              0.24169921874999997,
              49.738681639280024
            ],
            [
              0.15380859375,
              49.52520834197442
            ],
            [
              0.263671875,
              49.410973199695846
            ],
            [
              -0.15380859375,
              49.31079887964633
            ],
            [
              -0.46142578125,
              49.33944093715546
            ],
            [
              -0.94482421875,
              49.396675075193976
            ],
            [
              -1.142578125,
              49.396675075193976
            ],
            [
              -1.3623046875,
              49.53946900793534
            ],
            [
              -1.2084960937499998,
              49.63917719651036
            ],
            [
              -1.494140625,
              49.681846899401286
            ],
            [
              -2.0654296875,
              49.69606181911566
            ],
            [
              -1.8896484375,
              49.52520834197442
            ],
            [
              -1.7578125,
              49.296471602658066
            ],
            [
              -1.64794921875,
              48.980216985374994
            ],
            [
              -1.47216796875,
              48.67645370777654
            ],
            [
              -1.77978515625,
              48.61838518688487
            ],
            [
              -1.8017578124999998,
              48.69096039092549
            ],
            [
              -2.109375,
              48.63290858589535
            ],
            [
              -2.373046875,
              48.647427805533546
            ],
            [
              -2.6806640625,
              48.516604348867475
            ],
            [
              -2.98828125,
              48.821332549646634
            ],
            [
              -3.251953125,
              48.79239019646406
            ],
            [
              -3.5815429687499996,
              48.76343113791796
            ],
            [
              -3.8232421874999996,
              48.66194284607006
            ],
            [
              -4.06494140625,
              48.67645370777654
            ],
            [
              -4.6142578125,
              48.60385760823255
            ],
            [
              -4.74609375,
              48.4146186174932
            ],
            [
              -4.2626953125,
              48.32703913063476
            ],
            [
              -4.5263671875,
              48.23930899024907
            ],
            [
              -4.2626953125,
              48.10743118848039
            ],
            [
              -4.7021484375,
              48.04870994288686
            ]
          ]]};

var boundaryGeom = L.TileLayer.boundaryCanvas('http://api.tiles.mapbox.com/v4/mapbox.streets-satellite/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 10,
    id: 'testSatellite',
    boundary: geom,
    trackAttribution: true,
    accessToken: 'sk.eyJ1IjoiZm94b2YiLCJhIjoiY2ozenNxaDN5MDZrYzMzb2I4c2JzdnRnNSJ9.vWmDnXtkrNrwKojc0vXQ2g'
});

var allTilesLayer = L.tileLayer('http://api.tiles.mapbox.com/v4/mapbox.streets-satellite/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 15,
    id: 'testSatellite',
    accessToken: 'sk.eyJ1IjoiZm94b2YiLCJhIjoiY2ozenNxaDN5MDZrYzMzb2I4c2JzdnRnNSJ9.vWmDnXtkrNrwKojc0vXQ2g'});

//Instanciation de la carte avec la bibliothèque leafletjs
var mymap = L.map('mapDiv').setView([43.50075243569041,
             -1.2634277343749998], 13);

//Création de la couche de tuiles (provenant d'openstreetmap)
var osmTiles = L.TileLayer.boundaryCanvas('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution : 'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
    maxZoom : 13,
    boundary: geom
});

/*Cette méthode se déclenche chaque fois qu'une tuile est chargée.
Elle va parcourir la liste de tuiles d'un layers (_tuiles) et regarder si elle a été chargée. Si telle est le cas,
alors on récupère l'url de provenance de la tuile. Ainsi, on obtient seulement les urls des tuiles qui ont besoin d'être chargées
pour afficher le polygone. */
osmTiles.on("tileload",function()
{ 
    console.clear();
    console.log(osmTiles);
    console.log(" --- TUILES CHARGEES ---");
    var counter = 1;
    for(var i in osmTiles._tiles){
        if(osmTiles._tiles[i].loaded != undefined){
            var x = osmTiles._tiles[i].coords['x'];
            var y = osmTiles._tiles[i].coords['y'];
            var z = osmTiles._tiles[i].coords['z'];
            tileUrl = "http://{s}.tile.openstreetmap.org/"+z+"/"+x+"/"+y+".png";
            tileUrl = tileUrl.replace("{s}.", "");
            console.log(counter +" : "+tileUrl);
            counter++;
        }
    }

});
osmTiles.addTo(mymap);

var geomString = JSON.stringify(geom);

var cover = require('@mapbox/tile-cover');

console.log("On va parser le geojson");
var poly = JSON.parse(geomString);
var limits = {
  	min_zoom: 1,
  	max_zoom: 18
};

//cover.geojson(poly.geom, limits);
cover.tiles(poly.geom, limits);
//cover.indexes(poly.geom, limits);


